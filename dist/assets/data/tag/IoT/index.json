{"hash":"8f5d2da4bd612b0bc4d056d7cb77c1bed784ec30","data":{"tag":{"title":"IoT","belongsTo":{"edges":[{"node":{"title":"Garden Hacking - Plant Monitor","path":"/garden-hacking-plant-monitor/","date":"11th January 2018","timeToRead":7,"description":"Got some plants to take care of? A spare microcontroller? Spare resources on a server?  An Amazon Echo? Well, step right up, this guide is for you!","content":"<p>A couple of years ago I received a \"chili in a can\" as a bit of a joke gift and I didn't take it too seriously, but never-the-less I followed the instructions and actually managed to grow a good few chili plants in the harsh and unforgiving environment that is my house.</p>\n<blockquote>\n<p>[</p>\n<p> View this post on Instagram</p>\n<p>](<a href=\"https://www.instagram.com/p/BEGU4uTDhsJ/?utm_source=ig_embed&#x26;utm_medium=loading\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://www.instagram.com/p/BEGU4uTDhsJ/?utm_source=ig_embed&#x26;utm_medium=loading</a>)\n<a href=\"https://www.instagram.com/p/BEGU4uTDhsJ/?utm_source=ig_embed&#x26;utm_medium=loading\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">I am no Mark Whatney, however, I'm deliriously happy about managing to bring a chilli plant into the harsh and unforgiving environment that is my living room! #chili #gardening</a></p>\n<p>A post shared by <a href=\"https://www.instagram.com/huntlycameron/?utm_source=ig_embed&#x26;utm_medium=loading\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"> Huntly Cameron</a> (@huntlycameron) on Apr 12, 2016 at 4:39am PDT</p>\n</blockquote>\n<p>At the time I was teaching myself how to cook properly and so driven on by the success of the chili plants I started growing my own herbs as well and all was well with the world.</p>\n<blockquote>\n<p>[</p>\n<p> View this post on Instagram</p>\n<p>](<a href=\"https://www.instagram.com/p/BIccDEwAYMM/?utm_source=ig_embed&#x26;utm_medium=loading\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://www.instagram.com/p/BIccDEwAYMM/?utm_source=ig_embed&#x26;utm_medium=loading</a>)\n<a href=\"https://www.instagram.com/p/BIccDEwAYMM/?utm_source=ig_embed&#x26;utm_medium=loading\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Told Onion that she had better clean up her herb garden as it's becoming a bit of a jungle #herb #jungle #gardening #cat #catsofinstgram #catstagram</a></p>\n<p>A post shared by <a href=\"https://www.instagram.com/huntlycameron/?utm_source=ig_embed&#x26;utm_medium=loading\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"> Huntly Cameron</a> (@huntlycameron) on Jul 29, 2016 at 4:51am PDT</p>\n</blockquote>\n<p>Fast forward to now. It's January. It's cold. I'm cold. The cat is cold, and my permafrosted car has a small family of penguins who've made themselves at home in the boot. ¬† Whilst it is cold, and the days are still short, it is also the recommended time to plant chili seeds for the year - especially the hotter varieties.</p>\n<p>I've never done early planting and I'm worried about the heat (or lack thereof) and also I'm pretty forgetful when it comes to watering schedules. ¬†The later is not a big problem as forgetting to water plants is fine in Scotland when they live outside as it rains a fair bit.</p>\n<p>What's a geek to do with all this worry? Well, that's easy - create an over-the-top monitoring solution of course!</p>\n<blockquote>\n<p>[</p>\n<p> View this post on Instagram</p>\n<p>](<a href=\"https://www.instagram.com/p/BeK6qDjg2U5/?utm_source=ig_embed&#x26;utm_medium=loading\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://www.instagram.com/p/BeK6qDjg2U5/?utm_source=ig_embed&#x26;utm_medium=loading</a>)\n<a href=\"https://www.instagram.com/p/BeK6qDjg2U5/?utm_source=ig_embed&#x26;utm_medium=loading\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">This year's first batch of chili plants seem off to a good start üå∂Ô∏èüå±üëç And yes, they're hooked up to the internet for no reason other than just because I can üòÅ #chilli #urbangarden #espruino #javascript #programming #iot</a></p>\n<p>A post shared by <a href=\"https://www.instagram.com/huntlycameron/?utm_source=ig_embed&#x26;utm_medium=loading\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"> Huntly Cameron</a> (@huntlycameron) on Jan 20, 2018 at 4:03am PST</p>\n</blockquote>\n<p>I've gone through a few iterations of this, and will likely go through a few more iterations before I'm happy. So far the iterations are:</p>\n<ul>\n<li>Local monitoring using the standard Espurino board. (<a href=\"https://github.com/huntlyc/Espruino-Plant-Monitoring-System\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Github repo/instructions</a>)</li>\n<li>Remote monitoring by plugging the Espruino board straight into a raspberry pi zero via USB to essentially use the Espruino as an analog reader for the pi. ¬†(<a href=\"https://github.com/huntlyc/pi-espruino-plant-monitor\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Github repo/instructions</a>)</li>\n</ul>\n<p>My current setup is using a shiny new <a href=\"http://www.espruino.com/WiFi\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Espruino WiFi</a> that basically cuts out the pi (middle) man.</p>\n<p>Note: the raspberry pi doesn't have analog reading built in and you need <a href=\"https://shop.pimoroni.com/products/raspio-analog-zero\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">additional hardware</a> to get it.</p>\n<h2 id=\"system-architecture\"><a href=\"#system-architecture\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>System Architecture</h2>\n<p>The architecture for this is pretty straightforward:</p>\n<ol>\n<li>Espruino reads soil moisture levels and temperature data at a set interval (I've got mine set up for every minute or thereabouts).</li>\n<li>After collecting this data it sends it to a remote web server running a PHP application to store this information.</li>\n<li>The PHP application has the business logic to look at the data and if the data is out of bounds, and the previous data wasn't out of bounds, it mails me.</li>\n<li><strong>Bonus step</strong>: I also made an Amazon Alexa app to tell me how things are on command which is beyond overkill but was fun to do.</li>\n</ol>\n<p>If you want the <strong>TL;DR</strong> version, here's a link straight to the <a href=\"https://github.com/huntlyc/espruino-wifi-plant-monitor\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Github repo</a> which includes instructions in the README.</p>\n<h2 id=\"espruino-soil-and-temperature-reader\"><a href=\"#espruino-soil-and-temperature-reader\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Espruino Soil and Temperature Reader</h2>\n<p>Why Espruino? ¬†Well, why not. ¬†I backed the Kickstarter because as an Arduino fan and as a web developer, I was intrigued by the idea of a microcontroller running Javascript. ¬†Also, it was the first microcontroller that came to hand when I went about <a href=\"https://github.com/huntlyc/espruino-xmas-lights\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">hacking a set of battery powered lights for my Christmas tree</a>.</p>\n<h3 id=\"shopping-list\"><a href=\"#shopping-list\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Shopping list</h3>\n<ul>\n<li><a href=\"http://www.espruino.com/WiFi\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Espruino</a></li>\n<li><a href=\"https://www.sparkfun.com/products/245\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">One Wire Digital Temperature Sensor - DS18B20</a></li>\n<li><a href=\"https://www.bitsbox.co.uk/index.php?main_page=product_info&#x26;cPath=302_306&#x26;products_id=2816\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Soil Moisture Sensor</a></li>\n<li>4.7K resistor - If you don't have one, get a <a href=\"https://coolcomponents.co.uk/products/resistor-kit-1-4w-500-total\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">resistor pack</a></li>\n</ul>\n<h3 id=\"wiring-it-up\"><a href=\"#wiring-it-up\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Wiring it up</h3>\n<p>There are only 2 sensors in this project, both share the ground rail. The temperature sensor takes its power from the 3.3v rail, but the soil moisture sensor takes its power from the B9 pin which is turned on for one second before taking the reading and then turned off. This is to conserve the sensor as keeping it on corrodes the sensor. ¬†To follow along with the pins, see the pinout diagram on the <a href=\"http://www.espruino.com/WiFi\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Espruino WiFi page</a>.</p>\n<h4 id=\"soil-sensor-analog-output\"><a href=\"#soil-sensor-analog-output\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Soil Sensor (Analog output)</h4>\n<ul>\n<li>VCC - straight to pin B9</li>\n<li>GND - ground rail</li>\n<li>DO - <em>not used</em></li>\n<li>AO - straight to pin B0</li>\n</ul>\n<h4 id=\"temperature-sensor\"><a href=\"#temperature-sensor\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Temperature Sensor</h4>\n<p>With the rounded side facing <strong><em>away</em></strong> from left to right:</p>\n<ul>\n<li>0 - Ground rail</li>\n<li>1 - pin B1</li>\n<li>2 - 3.3v rail</li>\n</ul>\n<p><strong><em>Note:</em></strong> You need to put the 4.7K resistor between pins 1 &#x26; 2 (data and power)</p>\n<h4 id=\"configuration\"><a href=\"#configuration\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Configuration</h4>\n<p>The server endpoint details and token details are in a \"module\". This is to allow any configuration updates (WiFi, or endpoint) to not be tracked by git (see <a href=\"https://www.huntlycameron.co.uk/git-ignore-file-change/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">this post</a> if you're doing this yourself). The configuration file is \"<em>modules/projectConfig.js</em>\" and is just a simple JSON file. Be sure to plug in your own details into it before running.</p>\n<h2 id=\"web-application\"><a href=\"#web-application\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Web Application</h2>\n<p>I've written the application in PHP because my web server has it running already for this blog. ¬†You may write your own application in whichever language you choose. All it does is the following:</p>\n<ul>\n<li>Receive a form post request.</li>\n<li>Gets previous data from a file and checks if either temperature or moisture has failed since last time.</li>\n<li>Act on the data if needed to email the user.</li>\n<li>Save the new data to a file.</li>\n</ul>\n<p>The application also handles an HTTP GET request for data and will output the last saved reading in plain text by default or JSON format.</p>\n<p>The example app lives inside the php_server_example folder of the <a href=\"https://github.com/huntlyc/espruino-wifi-plant-monitor/tree/master/php_server_example\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Github repository</a>.</p>\n<h2 id=\"bonus-alexa\"><a href=\"#bonus-alexa\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Bonus: Alexa</h2>\n<p>Creating an Alexa skill is not particularly easy the first time you try to do it, thankfully Amazon is currently trying to get people interested in it and have created a <a href=\"https://developer.amazon.com/alexa-skills-kit/alexa-skill-quick-start-tutorial\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">quick start guide in python</a>. ¬†Through the guide, you set up a free tier account on AWS and create a lambda function to host your Alexa app code. ¬†You could host the code yourself too, but there are some requirements Amazon need in terms of SSL.</p>\n<p>A couple of things I found:</p>\n<ul>\n<li>Host your lambda function as geographically close to your Echo as possible. ¬†For me, in Scotland, I used Ireland.</li>\n<li>Create the Alexa app with the same language setting that your Echo has. ¬†My Echo is set to English (U.K) and so I used English (U.K) as my language setting when creating the Alexa app.</li>\n</ul>\n<p>The code for the Alexa app is <a href=\"https://github.com/huntlyc/espruino-wifi-plant-monitor/tree/master/alexa_app\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">contained within the repository</a>. ¬†To get it working, follow along with the quick start guide and then overwrite the lambda code with my code contained within the \"<em>lambda_function.py</em>\" file<em>.</em> ¬†You'll need to setup 3 environment variables:</p>\n<ul>\n<li><strong>ALEXA_APP_ID</strong>: You can get this from the Alexa dashboard where you created the skill</li>\n<li><strong>WEB_AUTH_TOKEN</strong>: The \"SUPER_SECRET_TOKEN\" you set up to share data between the Espruino and your web application.</li>\n<li><strong>WEB_ENDPOINT</strong>: The URL to get the data from. ¬†This is the same URL that your web application runs on. Alexa calls it as a get request with the \"<strong>WEB_AUTH_TOKEN</strong>\".</li>\n</ul>\n<p>In the Alexa dashboard where you set up your intents, use the beta editor, then select code editor and overwrite what is there with the JSON contained in the \"<em>interaction_model.</em>json\" file.</p>\n<p>The Alexa app will echo (see what I did there) out the information it pulls from the PHP application. ¬†On your Alexa app, it will display the raw temperature and moisture data on a card so you can see what exactly is going on should you need to.</p>\n<h2 id=\"future-additions-to-this-project\"><a href=\"#future-additions-to-this-project\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Future additions to this project</h2>\n<p>I'd like to get a few more soil and temperature sensors and have them monitor a couple of small propagators and an already established houseplant. ¬†With this addition, I'll likely try to expand the Alexa app to cope.</p>\n<p>I'd also probably want to store the information in a data store and then graph it out so I can see changes over time and use a Progressive Web App to output this so I can view stats more easily on my phone.</p>\n"}}]}}},"context":{}}